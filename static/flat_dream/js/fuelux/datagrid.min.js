define(["require","jquery"],function(c){var e=c("jquery");var a=e.fn.datagrid;var b=22;var d=function(h,g){this.$element=e(h);this.$thead=this.$element.find("thead");this.$tfoot=this.$element.find("tfoot");this.$footer=this.$element.find("tfoot th");this.$footerchildren=this.$footer.children().show().css("visibility","hidden");this.$topheader=this.$element.find("thead th");this.$searchcontrol=this.$element.find(".datagrid-search");this.$filtercontrol=this.$element.find(".filter");this.$pagesize=this.$element.find(".grid-pagesize");this.$pageinput=this.$element.find(".grid-pager input");this.$pagedropdown=this.$element.find(".grid-pager .dropdown-menu");this.$prevpagebtn=this.$element.find(".grid-prevpage");this.$nextpagebtn=this.$element.find(".grid-nextpage");this.$pageslabel=this.$element.find(".grid-pages");this.$countlabel=this.$element.find(".grid-count");this.$startlabel=this.$element.find(".grid-start");this.$endlabel=this.$element.find(".grid-end");this.$tbody=e("<tbody>").insertAfter(this.$thead);this.$colheader=e("<tr>").appendTo(this.$thead);this.options=e.extend(true,{},e.fn.datagrid.defaults,g);if(this.$pagesize.hasClass("select")){this.$pagesize.select("selectByValue",this.options.dataOptions.pageSize);this.options.dataOptions.pageSize=parseInt(this.$pagesize.select("selectedItem").value,10)}else{var f=this.options.dataOptions.pageSize;this.$pagesize.find("option").filter(function(){return e(this).text()===f.toString()}).attr("selected",true);this.options.dataOptions.pageSize=parseInt(this.$pagesize.val(),10)}if(this.$searchcontrol.length<=0){this.$searchcontrol=this.$element.find(".search")}this.columns=this.options.dataSource.columns();this.$nextpagebtn.on("click",e.proxy(this.next,this));this.$prevpagebtn.on("click",e.proxy(this.previous,this));this.$searchcontrol.on("searched cleared",e.proxy(this.searchChanged,this));this.$filtercontrol.on("changed",e.proxy(this.filterChanged,this));this.$colheader.on("click","th",e.proxy(this.headerClicked,this));if(this.$pagesize.hasClass("select")){this.$pagesize.on("changed",e.proxy(this.pagesizeChanged,this))}else{this.$pagesize.on("change",e.proxy(this.pagesizeChanged,this))}this.$pageinput.on("change",e.proxy(this.pageChanged,this));this.renderColumns();if(this.options.stretchHeight){this.initStretchHeight()}this.renderData()};d.prototype={constructor:d,renderColumns:function(){var f;this.$footer.attr("colspan",this.columns.length);this.$topheader.attr("colspan",this.columns.length);var g="";e.each(this.columns,function(h,i){g+='<th data-property="'+i.property+'"';if(i.sortable){g+=' class="sortable"'}g+=">"+i.label+"</th>"});this.$colheader.append(g);if(this.options.dataOptions.sortProperty){f=this.$colheader.children('th[data-property="'+this.options.dataOptions.sortProperty+'"]');this.updateColumns(f,this.options.dataOptions.sortDirection)}},updateColumns:function(f,g){this._updateColumns(this.$colheader,f,g);if(this.$sizingHeader){this._updateColumns(this.$sizingHeader,this.$sizingHeader.find("th").eq(f.index()),g)}},_updateColumns:function(g,f,i){var h=(i==="asc")?"icon-chevron-up":"icon-chevron-down";g.find("i.datagrid-sort").remove();g.find("th").removeClass("sorted");e("<i>").addClass(h+" datagrid-sort").appendTo(f);f.addClass("sorted")},updatePageDropdown:function(g){var h="";for(var f=1;f<=g.pages;f++){h+="<li><a>"+f+"</a></li>"}this.$pagedropdown.html(h)},updatePageButtons:function(f){if(f.page===1){this.$prevpagebtn.attr("disabled","disabled")}else{this.$prevpagebtn.removeAttr("disabled")}if(f.page===f.pages){this.$nextpagebtn.attr("disabled","disabled")}else{this.$nextpagebtn.removeAttr("disabled")}},renderData:function(){var f=this;this.$tbody.html(this.placeholderRowHTML(this.options.loadingHTML));this.options.dataSource.data(this.options.dataOptions,function(i){if(typeof i==="string"){f.$footerchildren.css("visibility","hidden");f.$tbody.html(f.errorRowHTML(i));f.stretchHeight();f.$element.trigger("loaded");return}var h=(i.count===1)?f.options.itemText:f.options.itemsText;var g="";f.$footerchildren.css("visibility",function(){return(i.count>0)?"visible":"hidden"});f.$pageinput.val(i.page);f.$pageslabel.text(i.pages);f.$countlabel.text(i.count+" "+h);f.$startlabel.text(i.start);f.$endlabel.text(i.end);f.updatePageDropdown(i);f.updatePageButtons(i);e.each(i.data,function(j,k){g+="<tr>";e.each(f.columns,function(l,m){g+="<td";if(m.cssClass){g+=' class="'+m.cssClass+'"'}g+=">"+k[m.property]+"</td>"});g+="</tr>"});if(!g){g=f.placeholderRowHTML(f.options.noDataFoundHTML)}f.$tbody.html(g);f.stretchHeight();f.$element.trigger("loaded")})},errorRowHTML:function(f){return'<tr><td style="text-align:center;padding:20px 20px 0 20px;border-bottom:none;" colspan="'+this.columns.length+'"><div class="alert alert-error">'+f+"</div></td></tr>"},placeholderRowHTML:function(f){return'<tr><td style="text-align:center;padding:20px;border-bottom:none;" colspan="'+this.columns.length+'">'+f+"</td></tr>"},headerClicked:function(j){var f=e(j.target);if(!f.hasClass("sortable")){return}var i=this.options.dataOptions.sortDirection;var g=this.options.dataOptions.sortProperty;var h=f.data("property");if(g===h){this.options.dataOptions.sortDirection=(i==="asc")?"desc":"asc"}else{this.options.dataOptions.sortDirection="asc";this.options.dataOptions.sortProperty=h}this.options.dataOptions.pageIndex=0;this.updateColumns(f,this.options.dataOptions.sortDirection);this.renderData()},pagesizeChanged:function(g,f){if(f){this.options.dataOptions.pageSize=parseInt(f.value,10)}else{this.options.dataOptions.pageSize=parseInt(e(g.target).val(),10)}this.options.dataOptions.pageIndex=0;this.renderData()},pageChanged:function(h){var g=parseInt(e(h.target).val(),10);g=(isNaN(g))?1:g;var f=this.$pageslabel.text();this.options.dataOptions.pageIndex=(g>f)?f-1:g-1;this.renderData()},searchChanged:function(g,f){this.options.dataOptions.search=f;this.options.dataOptions.pageIndex=0;this.renderData()},filterChanged:function(g,f){this.options.dataOptions.filter=f;this.options.dataOptions.pageIndex=0;this.renderData()},previous:function(){this.$nextpagebtn.attr("disabled","disabled");this.$prevpagebtn.attr("disabled","disabled");this.options.dataOptions.pageIndex--;this.renderData()},next:function(){this.$nextpagebtn.attr("disabled","disabled");this.$prevpagebtn.attr("disabled","disabled");this.options.dataOptions.pageIndex++;this.renderData()},reload:function(){this.options.dataOptions.pageIndex=0;this.renderData()},initStretchHeight:function(){this.$gridContainer=this.$element.parent();this.$element.wrap('<div class="datagrid-stretch-wrapper">');this.$stretchWrapper=this.$element.parent();this.$headerTable=e("<table>").attr("class",this.$element.attr("class"));this.$footerTable=this.$headerTable.clone();this.$headerTable.prependTo(this.$gridContainer).addClass("datagrid-stretch-header");this.$thead.detach().appendTo(this.$headerTable);this.$sizingHeader=this.$thead.clone();this.$sizingHeader.find("tr:first").remove();this.$footerTable.appendTo(this.$gridContainer).addClass("datagrid-stretch-footer");this.$tfoot.detach().appendTo(this.$footerTable)},stretchHeight:function(){if(!this.$gridContainer){return}this.setColumnWidths();var f=this.$gridContainer.height();var h=this.$headerTable.outerHeight();var i=this.$footerTable.outerHeight();var g=h+i;this.$stretchWrapper.height(f-g)},setColumnWidths:function(){if(!this.$sizingHeader){return}this.$element.prepend(this.$sizingHeader);var g=this.$sizingHeader.find("th");var f=g.length;function h(k,m){if(k===f-1){return}var j=e(m);var n=g.eq(k);var l=n.width();if(n.hasClass("sorted")&&j.prop("tagName")==="TD"){l=l+b}j.width(l)}this.$colheader.find("th").each(h);this.$tbody.find("tr:first > td").each(h);this.$sizingHeader.detach()}};e.fn.datagrid=function(h){var g=Array.prototype.slice.call(arguments,1);var i;var f=this.each(function(){var l=e(this);var k=l.data("datagrid");var j=typeof h==="object"&&h;if(!k){l.data("datagrid",(k=new d(this,j)))}if(typeof h==="string"){i=k[h].apply(k,g)}});return(i===undefined)?f:i};e.fn.datagrid.defaults={dataOptions:{pageIndex:0,pageSize:10},loadingHTML:'<div class="progress progress-striped active" style="width:50%;margin:auto;"><div class="bar" style="width:100%;"></div></div>',itemsText:"items",itemText:"item",noDataFoundHTML:"0 items"};e.fn.datagrid.Constructor=d;e.fn.datagrid.noConflict=function(){e.fn.datagrid=a;return this}});