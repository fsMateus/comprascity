define(["require","jquery"],function(c){var d=c("jquery");var a=d.fn.datepicker;var b=function(f,e){this.$element=d(f);this.options=d.extend(true,{},d.fn.datepicker.defaults,e);this.formatDate=(Boolean(this.options.createInput)&&Boolean(this.options.createInput["native"]))?this.formatNativeDate:this.options.formatDate||this.formatDate;this.parseDate=this.options.parseDate||this.parseDate;this.blackoutDates=this.options.blackoutDates||this.blackoutDates;this.date=this.options.date||new Date();this.date=this.parseDate(this.date);this.viewDate=new Date(this.date.valueOf());this.stagedDate=new Date(this.date.valueOf());this.viewDate.setHours(0,0,0,0);this.stagedDate.setHours(0,0,0,0);this.done=false;this.callbacks=[];this.minDate=new Date();this.minDate.setDate(this.minDate.getDate()-1);this.minDate.setHours(0,0,0,0);this.maxDate=new Date();this.maxDate.setFullYear(this.maxDate.getFullYear()+10);this.maxDate.setHours(23,59,59,999);this.years=this._yearRange(this.viewDate);this.bindingsAdded=false;this.options.dropdownWidth=this.options.dropdownWidth||170;this.options.monthNames=this.options.monthNames||["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];this.options.weekdays=this.options.weekdays||["Su","Mo","Tu","We","Th","Fr","Sa"];this.options.showYears=false;this.options.showDays=true;this.options.showMonths=false;this.options.restrictLastMonth=Boolean(this.options.restrictDateSelection);this.options.restrictNextMonth=false;this.months=[{abbreviation:this.options.monthNames[0],"class":"",number:0},{abbreviation:this.options.monthNames[1],"class":"",number:1},{abbreviation:this.options.monthNames[2],"class":"",number:2},{abbreviation:this.options.monthNames[3],"class":"",number:3},{abbreviation:this.options.monthNames[4],"class":"",number:4},{abbreviation:this.options.monthNames[5],"class":"",number:5},{abbreviation:this.options.monthNames[6],"class":"",number:6},{abbreviation:this.options.monthNames[7],"class":"",number:7},{abbreviation:this.options.monthNames[8],"class":"",number:8},{abbreviation:this.options.monthNames[9],"class":"",number:9},{abbreviation:this.options.monthNames[10],"class":"",number:10},{abbreviation:this.options.monthNames[11],"class":"",number:11}];if(Boolean(this.options.createInput)){if(typeof this.options.createInput==="boolean"&&Boolean(this.options.createInput)){this.options.createInput={}}if(typeof this.options.createInput==="object"&&isNaN(this.options.createInput.length)){this.options.createInput.inputSize=this.options.createInput.inputSize||"span3";this._renderInput()}else{throw new Error("createInput option needs to be an object or boolean true")}}else{this._render()}};b.prototype={constructor:b,disable:function(){this.$element.find("input, button").attr("disabled",true)},enable:function(){this.$element.find("input, button").attr("disabled",false)},getFormattedDate:function(){return this.formatDate(this.date)},getDate:function(e){if(Boolean(e)&&Boolean(e.unix)){return this.date.getTime()}else{return this.date}},setDate:function(e,f){f=f||false;this.date=this.parseDate(e,f);this.stagedDate=new Date(this.date);this.viewDate=new Date(this.date);this._render();this.$element.trigger("changed",this.date);return this.date},formatDate:function(e){return this.padTwo(e.getMonth()+1)+"-"+this.padTwo(e.getDate())+"-"+e.getFullYear()},formatNativeDate:function(e){return e.getFullYear()+"-"+this.padTwo(e.getMonth()+1)+"-"+this.padTwo(e.getDate())},parseDate:function(e,f){var h,g,j,i;if(Boolean(e)&&new Date(e)!=="Invalid Date"){if(typeof(e)==="string"&&!f){e=e.split("T")[0];g=/^\s*(\d{4})-(\d\d)-(\d\d)\s*$/;h=new Date(NaN);i=g.exec(e);if(i){j=+i[2];h.setFullYear(i[1],j-1,i[3]);if(j!==h.getMonth()+1){h.setTime(NaN)}}return h}return new Date(e)}else{throw new Error("could not parse date")}},blackoutDates:function(e){e=e;return false},padTwo:function(f){var e="0"+f;return e.substr(e.length-2)},_restrictDateSelectionSetup:function(){var f,e;if(Boolean(this.options)){if(!this.options.restrictDateSelection){f=false;e=false}else{e=(this.viewDate.getMonth()<new Date().getMonth())?true:false;f=(this.viewDate.getMonth()>new Date().getMonth())?false:true}}this.options.restrictLastMonth=f;this.options.restrictNextMonth=e},_repeat:function(g,l,j,e){var k=g;for(var f=0,h=l.length;f<h;f++){k+=j(l[f])}k+=e;return k},_getDaysInMonth:function(f,e){return 32-new Date(e,f,32).getDate()},_range:function(h,f){var e=[];for(var g=h;g<f;g++){e[e.length]=g}return e},_yearRange:function(h){var m=(Math.floor(h.getFullYear()/10)*10)-1;var e=m+12;var k=this._range(m,e);var f=[];for(var j=0,l=k.length;j<l;j++){var g="";if(j===0){g="previous"}if(j===k.length-1){g="next"}f[j]={number:k[j],"class":g}}return f},_killEvent:function(f){f.stopPropagation();f.preventDefault();return false},_applySize:function(g,f){for(var e=0;e<g.length;e++){d(g[e]).css({width:f,height:f,"line-height":f})}},_show:function(e){return e?"":"display: none;"},_hide:function(e){return this._show(!e)},_runCallbacks:function(){for(var e=0;e<this.callbacks.length;e++){this.callbacks[e](this.date)}},_showView:function(e){if(e===1){this.options.showDays=true;this.options.showMonths=false;this.options.showYears=false}else{if(e===2){this.options.showDays=false;this.options.showMonths=true;this.options.showYears=false}else{if(e===3){this.options.showDays=false;this.options.showMonths=false;this.options.showYears=true}}}},_updateCalendarData:function(){var q=this.viewDate.getMonth();var l=this.viewDate.getFullYear();var J=this.stagedDate.getDate();var e=this.stagedDate.getMonth();var p=this.stagedDate.getFullYear();var o=new Date(l,q,1).getDay();var O=this._getDaysInMonth(q,l);var w=this._getDaysInMonth(q-1,l);if(o===0){o=7}var f=(42-O)-o;this.daysOfLastMonth=this._range(w-o+1,w+1);this.daysOfNextMonth=this._range(1,f+1);for(var E=0,v=this.daysOfLastMonth.length;E<v;E++){var Q={};Q.number=this.daysOfLastMonth[E];Q["class"]="";if(Boolean(this.blackoutDates(new Date(l,q+1,this.daysOfLastMonth[E],0,0,0,0)))){Q["class"]="restrict blackout"}this.daysOfLastMonth[E]=Q}for(var P=0,T=this.daysOfNextMonth.length;P<T;P++){var R={};R.number=this.daysOfNextMonth[P];R["class"]="";if(Boolean(this.blackoutDates(new Date(l,q+1,this.daysOfNextMonth[P],0,0,0,0)))){R["class"]="restrict blackout"}this.daysOfNextMonth[P]=R}var H=new Date();var s=H.getDate();var u=H.getMonth();var m=H.getFullYear();var S=q===u;var G=l===m;var t=q===e;var F=l===p;var B=this._range(1,O+1);this.daysOfThisMonth=[];for(var L=0,y=B.length;L<y;L++){var N=new Date(l,q,B[L]).getDay();var I="weekday";if(N===6||N===0){I="weekend"}if(N===1){I=""}I+=" weekday"+N;if(B[L]===J&&t&&F){I+=" selected"}else{if(B[L]===s&&S&&G){I+=" today"}}var k=new Date(l,q,B[L],0,0,0,0);if(k<=this.minDate||k>=this.maxDate){if(Boolean(this.blackoutDates(k))){I+=" restrict blackout"}else{if(Boolean(this.options)&&Boolean(this.options.restrictDateSelection)){I+=" restrict"}else{I+=" past"}}}else{if(Boolean(this.blackoutDates(k))){I+=" restrict blackout"}}this.daysOfThisMonth[this.daysOfThisMonth.length]={number:B[L],"class":I}}var h=this._getDaysInMonth(this.minDate.getFullYear(),this.minDate.getMonth());for(var K=0,n=this.months.length;K<n;K++){this.months[K]["class"]="";if(G&&K===u){this.months[K]["class"]+=" today"}if(K===e&&F){this.months[K]["class"]+=" selected"}var g=new Date(l,K,h,23,59,59,999);var A=new Date(l,K,0,0,0,0,0);if(g<=this.minDate||A>=this.maxDate){if(Boolean(this.options.restrictDateSelection)){this.months[K]["class"]+=" restrict"}}}this.years=this._yearRange(this.viewDate);h=this._getDaysInMonth(this.minDate.getFullYear(),11);for(var D=0,M=this.years.length;D<M;D++){if(this.years[D].number===m){this.years[D]["class"]+=" today"}if(this.years[D].number===p){this.years[D]["class"]+=" selected"}var r=new Date(this.years[D].number,11,h,23,59,59,999);var C=new Date(this.years[D].number,0,0,0,0,0,0);if(r<=this.minDate||C>=this.maxDate){if(Boolean(this.options.restrictDateSelection)){this.years[D]["class"]+=" restrict"}}}},_updateCss:function(){while(this.options.dropdownWidth%7!==0){this.options.dropdownWidth++}this.$view.css("width",this.options.dropdownWidth+"px");this.$header.css("width",this.options.dropdownWidth+"px");this.$labelDiv.css("width",(this.options.dropdownWidth-60)+"px");this.$footer.css("width",this.options.dropdownWidth+"px");var e=(this.options.dropdownWidth*0.25)-2;var g=Math.round((this.options.dropdownWidth-(e*3))/2);var h=g;while(h+g+(e*3)<this.options.dropdownWidth){h+=0.1}while(h+g+(e*3)>this.options.dropdownWidth){h-=0.1}this.$calendar.css({"float":"left"});this.$monthsView.css({width:this.options.dropdownWidth+"px","padding-top":g+"px","padding-bottom":h+"px"});this.$yearsView.css({width:this.options.dropdownWidth+"px","padding-top":g+"px","padding-bottom":h+"px"});var i=Math.round(this.options.dropdownWidth/7)-2+"px";var f=Math.round(this.options.dropdownWidth/7)+"px";this._applySize(this.$yearsView.children(),e+"px");this._applySize(this.$monthsView.children(),e+"px");this._applySize(this.$weekdaysDiv.children(),f);this._applySize(this.$lastMonthDiv.children(),i);this._applySize(this.$thisMonthDiv.children(),i);this._applySize(this.$nextMonthDiv.children(),i)},_close:function(){this.$input.dropdown("toggle")},_select:function(f){if(f.target.className.indexOf("restrict")>-1){return this._killEvent(f)}else{this._killEvent(f);this._close()}this.stagedDate=this.viewDate;this.stagedDate.setDate(parseInt(f.target.innerHTML,10));this.setDate(this.stagedDate);this._render();this.done=true;this._runCallbacks()},_pickYear:function(g){var f=parseInt(d(g.target).data("yearNumber"),10);if(g.target.className.indexOf("restrict")>-1){return this._killEvent(g)}this.viewDate=new Date(f,this.viewDate.getMonth(),1);this._showView(2);this._render();return this._killEvent(g)},_pickMonth:function(g){var f=parseInt(d(g.target).data("monthNumber"),10);if(g.target.className.indexOf("restrict")>-1){return this._killEvent(g)}this.viewDate=new Date(this.viewDate.getFullYear(),f,1);this._showView(1);this._render();return this._killEvent(g)},_previousSet:function(f){this._previous(f,true)},_previous:function(f,g){if(f.target.className.indexOf("restrict")>-1){return this._killEvent(f)}if(this.options.showDays){this.viewDate=new Date(this.viewDate.getFullYear(),this.viewDate.getMonth()-1,1)}else{if(this.options.showMonths){this.viewDate=new Date(this.viewDate.getFullYear()-1,this.viewDate.getMonth(),1)}else{if(this.options.showYears){this.viewDate=new Date(this.viewDate.getFullYear()-10,this.viewDate.getMonth(),1)}}}if(Boolean(g)){this._select(f)}else{this._render()}return this._killEvent(f)},_nextSet:function(f){this._next(f,true)},_next:function(f,g){if(f.target.className.indexOf("restrict")>-1){return this._killEvent(f)}if(this.options.showDays){this.viewDate=new Date(this.viewDate.getFullYear(),this.viewDate.getMonth()+1,1)}else{if(this.options.showMonths){this.viewDate=new Date(this.viewDate.getFullYear()+1,this.viewDate.getMonth(),1)}else{if(this.options.showYears){this.viewDate=new Date(this.viewDate.getFullYear()+10,this.viewDate.getMonth(),1)}}}if(Boolean(g)){this._select(f)}else{this._render()}return this._killEvent(f)},_today:function(f){this.viewDate=new Date();this._showView(1);this._render();return this._killEvent(f)},_emptySpace:function(f){if(Boolean(this.done)){this.done=false}return this._killEvent(f)},_monthLabel:function(){return this.options.monthNames[this.viewDate.getMonth()]},_yearLabel:function(){return this.viewDate.getFullYear()},_monthYearLabel:function(){var e;if(this.options.showDays){e=this._monthLabel()+" "+this._yearLabel()}else{if(this.options.showMonths){e=this._yearLabel()}else{if(this.options.showYears){e=this.years[0].number+" - "+this.years[this.years.length-1].number}}}return e},_toggleMonthYearPicker:function(f){if(this.options.showDays){this._showView(2)}else{if(this.options.showMonths){this._showView(3)}else{if(this.options.showYears){this._showView(1)}}}this._render();return this._killEvent(f)},_renderCalendar:function(){var e=this;e._restrictDateSelectionSetup();return'<div class="calendar"><div class="header clearfix"><div class="left hover"><div class="leftArrow"></div></div><div class="right hover"><div class="rightArrow"></div></div><div class="center hover">'+e._monthYearLabel()+'</div></div><div class="daysView" style="'+e._show(e.options.showDays)+'">'+e._repeat('<div class="weekdays">',e.options.weekdays,function(f){return"<div >"+f+"</div>"},"</div>")+e._repeat('<div class="lastmonth">',e.daysOfLastMonth,function(f){if(e.options.restrictLastMonth){f["class"]=f["class"].replace("restrict","")+" restrict"}return'<div class="'+f["class"]+'">'+f.number+"</div>"},"</div>")+e._repeat('<div class="thismonth">',e.daysOfThisMonth,function(f){return'<div class="'+f["class"]+'">'+f.number+"</div>"},"</div>")+e._repeat('<div class="nextmonth">',e.daysOfNextMonth,function(f){if(e.options.restrictNextMonth){f["class"]=f["class"].replace("restrict","")+" restrict"}return'<div class="'+f["class"]+'">'+f.number+"</div>"},"</div>")+"</div>"+e._repeat('<div class="monthsView" style="'+e._show(e.options.showMonths)+'">',e.months,function(f){return'<div data-month-number="'+f.number+'" class="'+f["class"]+'">'+f.abbreviation+"</div>"},"</div>")+e._repeat('<div class="yearsView" style="'+e._show(e.options.showYears)+'">',e.years,function(f){return'<div data-year-number="'+f.number+'" class="'+f["class"]+'">'+f.number+"</div>"},"</div>")+'<div class="footer"><div class="center hover">Today</div></div></div>'},_render:function(){this._insertDateIntoInput();this._updateCalendarData();if(Boolean(this.bindingsAdded)){this._removeBindings()}this.$element.find(".dropdown-menu").html(this._renderCalendar());this._initializeCalendarElements();this._addBindings();this._updateCss()},_renderInput:function(){var e=(Boolean(this.options.createInput["native"]))?this._renderInputNative():this._renderInputHTML();this.$element.html(e);this._render()},_renderInputNative:function(){return'<input type="date" value="'+this.formatDate(this.date)+'"'+this._calculateInputSize(["native"])+">"},_renderInputHTML:function(){var e=(Boolean(this.options.createInput.dropDownBtn))?"input-append":"input-group";var f='<div class="'+e+'"><div class="dropdown-menu"></div><input type="text" '+this._calculateInputSize()+' value="'+this.formatDate(this.date)+'" data-toggle="dropdown">';if(Boolean(this.options.createInput.dropDownBtn)){f=f+'<button type="button" class="btn" data-toggle="dropdown"><i class="icon-calendar"></i></button>'}f=f+"</div>";return'<div class="datepicker dropdown">'+f+"</div>"},_calculateInputSize:function(e){if(Boolean(parseInt(this.options.createInput.inputSize,10))){return'style="width:'+this.options.createInput.inputSize+'px"'}else{e=(Boolean(e))?" "+e.join(" "):"";return'class="'+this.options.createInput.inputSize+e+'"'}},_insertDateIntoInput:function(){this.$element.find('input[type="text"]').val(this.formatDate(this.date))},_keyupDateUpdate:function(h){var g=this.formatDate(this.date).length;var f=this.$input.val();if(g===f.length&&this._checkKeyCode(h)){this.setDate(f,true)}},_checkKeyCode:function(f){if(d.inArray(f.keyCode,[46,8,9,27,13,32])!==-1||(f.keyCode===65&&f.ctrlKey===true)||(f.keyCode>=35&&f.keyCode<=39)){return false}else{if(f.shiftKey||(f.keyCode>=48||f.keyCode<=57)||(f.keyCode>=96||f.keyCode<=105)||f.keyCode===110||f.keyCode===190||f.keyCode===191){return true}else{return false}}},_initializeCalendarElements:function(){this.$input=this.$element.find('input[type="text"]');this.$calendar=this.$element.find("div.calendar");this.$header=this.$calendar.children().eq(0);this.$labelDiv=this.$header.children().eq(2);this.$view=this.$calendar.children().eq(1);this.$monthsView=this.$calendar.children().eq(2);this.$yearsView=this.$calendar.children().eq(3);this.$weekdaysDiv=this.$view.children().eq(0);this.$lastMonthDiv=this.$view.children().eq(1);this.$thisMonthDiv=this.$view.children().eq(2);this.$nextMonthDiv=this.$view.children().eq(3);this.$footer=this.$calendar.children().eq(4)},_addBindings:function(){this.$input.on("keyup",d.proxy(this._keyupDateUpdate,this));this.$calendar.on("click",d.proxy(this._emptySpace,this));this.$header.find(".left").on("click",d.proxy(this._previous,this));this.$header.find(".right").on("click",d.proxy(this._next,this));this.$header.find(".center").on("click",d.proxy(this._toggleMonthYearPicker,this));this.$lastMonthDiv.find("div").on("click",d.proxy(this._previousSet,this));this.$thisMonthDiv.find("div").on("click",d.proxy(this._select,this));this.$nextMonthDiv.find("div").on("click",d.proxy(this._nextSet,this));this.$monthsView.find("div").on("click",d.proxy(this._pickMonth,this));this.$yearsView.find("div").on("click",d.proxy(this._pickYear,this));this.$footer.find(".center").on("click",d.proxy(this._today,this));this.bindingsAdded=true},_removeBindings:function(){this.$input.off("keyup");this.$calendar.off("click");this.$header.find(".left").off("click");this.$header.find(".right").off("click");this.$header.find(".center").off("click");this.$lastMonthDiv.find("div").off("click");this.$thisMonthDiv.find("div").off("click");this.$nextMonthDiv.find("div").off("click");this.$monthsView.find("div").off("click");this.$yearsView.find("div").off("click");this.$footer.find(".center").off("click");this.bindingsAdded=false}};d.fn.datepicker=function(g){var f=Array.prototype.slice.call(arguments,1);var h;var e=this.each(function(){var k=d(this);var j=k.data("datepicker");var i=typeof g==="object"&&g;if(!j){k.data("datepicker",(j=new b(this,i)))}if(typeof g==="string"){h=j[g].apply(j,f)}});return(h===undefined)?e:h};d.fn.datepicker.defaults={date:new Date(),createInput:false,dropdownWidth:170,restrictDateSelection:true};d.fn.datepicker.Constructor=b;d.fn.datepicker.noConflict=function(){d.fn.datepicker=a;return this}});