/*!=========================================================================
 *  Bootstrap TouchSpin
 *  v2.5.0
 *
 *  A mobile and touch friendly input spinner component for Bootstrap 3.
 *
 *      https://github.com/istvan-meszaros/bootstrap-touchspin
 *      http://www.virtuosoft.eu/code/bootstrap-touchspin/
 *
 *  Copyright 2013 István Ujj-Mészáros
 *
 *  Thanks for the contributors:
 *      Stefan Bauer - https://github.com/sba
 *      amid2887 - https://github.com/amid2887
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 *
* ====================================================================== */
(function(a){a.fn.TouchSpin=function(b){var c={min:0,max:100,initval:"",step:1,decimals:0,stepinterval:100,forcestepdivisibility:"round",stepintervaldelay:500,prefix:"",postfix:"",prefix_extraclass:"",postfix_extraclass:"",booster:true,boostat:10,maxboostedstep:false,mousewheel:true,buttondown_class:"btn btn-primary",buttonup_class:"btn btn-primary"};return this.each(function(){var E,r=a(this),q=r.data(),u,w,y,j,t,k,z,C=0,f=false;D();function D(){if(r.data("alreadyinitialized")){return}r.data("alreadyinitialized",true);if(!r.is("input")){console.log("Must be an input.");return}e();h();p();i();g();H();m()}function h(){if(E.initval!==""&&r.val()===""){r.val(E.initval)}}function v(J){s(J);p();var I=Number(w.input.val());w.input.val(I.toFixed(E.decimals))}function e(){E=a.extend({},c,q,b)}function s(I){E=a.extend({},E,I)}function i(){var J=r.val(),I=r.parent();if(J!==""){J=Number(J).toFixed(E.decimals)}r.data("initvalue",J).val(J);r.addClass("form-control");a("<style type='text/css'>.bootstrap-touchspin-prefix:empty,.bootstrap-touchspin-postfix:empty{display:none;}</style>").appendTo("head");if(I.hasClass("input-group")){d(I)}else{o()}}function d(J){J.addClass("bootstrap-touchspin");var M=r.prev(),L=r.next();var O,I,K='<span class="input-group-addon bootstrap-touchspin-prefix">'+E.prefix+"</span>",N='<span class="input-group-addon bootstrap-touchspin-postfix">'+E.postfix+"</span>";if(M.hasClass("input-group-btn")){O='<button class="'+E.buttondown_class+' bootstrap-touchspin-down" type="button">-</button>',M.append(O)}else{O='<span class="input-group-btn"><button class="'+E.buttondown_class+' bootstrap-touchspin-down" type="button">-</button></span>';a(O).insertBefore(r)}if(L.hasClass("input-group-btn")){I='<button class="'+E.buttonup_class+' bootstrap-touchspin-up" type="button">+</button>',L.prepend(I)}else{I='<span class="input-group-btn"><button class="'+E.buttonup_class+' bootstrap-touchspin-up" type="button">+</button></span>';a(I).insertAfter(r)}a(K).insertBefore(r);a(N).insertAfter(r);u=J}function o(){var I='<div class="input-group bootstrap-touchspin"><span class="input-group-btn"><button class="'+E.buttondown_class+' bootstrap-touchspin-down" type="button">-</button></span><span class="input-group-addon bootstrap-touchspin-prefix">'+E.prefix+'</span><span class="input-group-addon bootstrap-touchspin-postfix">'+E.postfix+'</span><span class="input-group-btn"><button class="'+E.buttonup_class+' bootstrap-touchspin-up" type="button">+</button></span></div>';u=a(I).insertBefore(r);a(".bootstrap-touchspin-prefix",u).after(r);if(r.hasClass("input-sm")){u.addClass("input-group-sm")}else{if(r.hasClass("input-lg")){u.addClass("input-group-lg")}}}function g(){w={down:a(".bootstrap-touchspin-down",u),up:a(".bootstrap-touchspin-up",u),input:a("input",u),prefix:a(".bootstrap-touchspin-prefix",u).addClass(E.prefix_extraclass),postfix:a(".bootstrap-touchspin-postfix",u).addClass(E.postfix_extraclass)}}function H(){r.on("keydown",function(J){var I=J.keyCode||J.which;if(I===38){if(f!=="up"){x();A()}J.preventDefault()}else{if(I===40){if(f!=="down"){F();G()}J.preventDefault()}}});r.on("keyup",function(J){var I=J.keyCode||J.which;if(I===38){l()}else{if(I===40){l()}}});r.on("blur",function(){p()});w.down.on("keydown",function(J){var I=J.keyCode||J.which;if(I===32||I===13){if(f!=="down"){F();G()}J.preventDefault()}});w.down.on("keyup",function(J){var I=J.keyCode||J.which;if(I===32||I===13){l()}});w.up.on("keydown",function(J){var I=J.keyCode||J.which;if(I===32||I===13){if(f!=="up"){x();A()}J.preventDefault()}});w.up.on("keyup",function(J){var I=J.keyCode||J.which;if(I===32||I===13){l()}});w.down.on("mousedown touchstart",function(I){F();G();I.preventDefault();I.stopPropagation()});w.up.on("mousedown touchstart",function(I){x();A();I.preventDefault();I.stopPropagation()});w.up.on("mouseout touchleave touchend touchcancel",function(I){if(!f){return}I.stopPropagation();l()});w.down.on("mouseout touchleave touchend touchcancel",function(I){if(!f){return}I.stopPropagation();l()});w.down.on("mousemove touchmove",function(I){if(!f){return}I.stopPropagation();I.preventDefault()});w.up.on("mousemove touchmove",function(I){if(!f){return}I.stopPropagation();I.preventDefault()});a(document).on("mouseup touchend touchcancel",function(I){if(!f){return}I.preventDefault();l()});a(document).on("mousemove touchmove scroll scrollstart",function(I){if(!f){return}I.preventDefault();l()});if(E.mousewheel){r.on("mousewheel DOMMouseScroll",function(I){var J=I.originalEvent.wheelDelta||-I.originalEvent.detail;I.stopPropagation();I.preventDefault();if(J<0){F()}else{x()}})}}function m(){r.on("touchspin.uponce",function(){l();x()});r.on("touchspin.downonce",function(){l();F()});r.on("touchspin.startupspin",function(){A()});r.on("touchspin.startdownspin",function(){G()});r.on("touchspin.stopspin",function(){l()});r.on("touchspin.updatesettings",function(I,J){v(J)})}function B(I){switch(E.forcestepdivisibility){case"round":return(Math.round(I/E.step)*E.step).toFixed(E.decimals);break;case"floor":return(Math.floor(I/E.step)*E.step).toFixed(E.decimals);break;case"ceil":return(Math.ceil(I/E.step)*E.step).toFixed(E.decimals);break;default:return I}}function p(){var K,I,J;K=r.val();if(K===""){return}if(E.decimals>0&&K==="."){return}I=parseFloat(K);if(isNaN(I)){I=0}J=I;if(I.toString()!==K){J=I}if(I<E.min){J=E.min}if(I>E.max){J=E.max}J=B(J);if(Number(K).toString()!==J.toString()){r.val(J);r.trigger("change")}}function n(){if(!E.booster){return E.step}else{var I=Math.pow(2,Math.floor(C/E.boostat))*E.step;if(E.maxboostedstep){if(I>E.maxboostedstep){I=E.maxboostedstep;y=Math.round((y/I)*I)}}return Math.max(E.step,I)}}function x(){p();y=parseFloat(w.input.val());if(isNaN(y)){y=0}var J=y,I=n();y=y+I;if(y>E.max){l();y=E.max;r.trigger("touchspin.max")}w.input.val(Number(y).toFixed(E.decimals));if(J!==y){r.trigger("change")}}function F(){p();y=parseFloat(w.input.val());if(isNaN(y)){y=0}var J=y,I=n();y=y-I;if(y<E.min){l();y=E.min;r.trigger("touchspin.min")}w.input.val(y.toFixed(E.decimals));if(J!==y){r.trigger("change")}}function G(){l();C=0;f="down";k=setTimeout(function(){j=setInterval(function(){C++;F()},E.stepinterval)},E.stepintervaldelay)}function A(){l();C=0;f="up";z=setTimeout(function(){t=setInterval(function(){C++;x()},E.stepinterval)},E.stepintervaldelay)}function l(){clearTimeout(k);clearTimeout(z);clearInterval(j);clearInterval(t);C=0;f=false}})}})(jQuery);