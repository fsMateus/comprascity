define("parsley/ui",["parsley/utils"],function(a){var b=function(c){this.__class__="ParsleyUI"};b.prototype={listen:function(){$.listen("parsley:form:init",this,this.setupForm);$.listen("parsley:field:init",this,this.setupField);$.listen("parsley:field:validated",this,this.reflow);$.listen("parsley:form:validated",this,this.focus);$.listen("parsley:field:reset",this,this.reset);$.listen("parsley:form:destroy",this,this.destroy);$.listen("parsley:field:destroy",this,this.destroy);return this},reflow:function(c){if("undefined"===typeof c._ui||false===c._ui.active){return}var d=this._diff(c.validationResult,c._ui.lastValidationResult);c._ui.lastValidationResult=c.validationResult;c._ui.validatedOnce=true;this.manageStatusClass(c);this.manageErrorsMessages(c,d);this.actualizeTriggers(c);if((d.kept.length||d.added.length)&&"undefined"===typeof c._ui.failedOnce){this.manageFailingFieldTrigger(c)}},getErrorsMessages:function(c){if(true===c.validationResult){return[]}var e=[];for(var d=0;d<c.validationResult.length;d++){e.push(this._getErrorMessage(c,c.validationResult[d].assert))}return e},manageStatusClass:function(c){if(true===c.validationResult){this._successClass(c)}else{if(c.validationResult.length>0){this._errorClass(c)}else{this._resetClass(c)}}},manageErrorsMessages:function(c,e){if("undefined"!==typeof c.options.errorsMessagesDisabled){return}if("undefined"!==typeof c.options.errorMessage){if((e.added.length||e.kept.length)){if(0===c._ui.$errorsWrapper.find(".parsley-custom-error-message").length){c._ui.$errorsWrapper.append($(c.options.errorTemplate).addClass("parsley-custom-error-message"))}return c._ui.$errorsWrapper.addClass("filled").find(".parsley-custom-error-message").html(c.options.errorMessage)}return c._ui.$errorsWrapper.removeClass("filled").find(".parsley-custom-error-message").remove()}for(var d=0;d<e.removed.length;d++){this.removeError(c,e.removed[d].assert.name,true)}for(d=0;d<e.added.length;d++){this.addError(c,e.added[d].assert.name,undefined,e.added[d].assert,true)}for(d=0;d<e.kept.length;d++){this.updateError(c,e.kept[d].assert.name,undefined,e.kept[d].assert,true)}},addError:function(d,e,f,c,g){d._ui.$errorsWrapper.addClass("filled").append($(d.options.errorTemplate).addClass("parsley-"+e).html(f||this._getErrorMessage(d,c)));if(true!==g){this._errorClass(d)}},updateError:function(d,e,f,c,g){d._ui.$errorsWrapper.addClass("filled").find(".parsley-"+e).html(f||this._getErrorMessage(d,c));if(true!==g){this._errorClass(d)}},removeError:function(c,d,e){c._ui.$errorsWrapper.removeClass("filled").find(".parsley-"+d).remove();if(true!==e){this.manageStatusClass(c)}},focus:function(d){if(true===d.validationResult||"none"===d.options.focus){return d._focusedField=null}d._focusedField=null;for(var c=0;c<d.fields.length;c++){if(true!==d.fields[c].validationResult&&d.fields[c].validationResult.length>0&&"undefined"===typeof d.fields[c].options.noFocus){if("first"===d.options.focus){d._focusedField=d.fields[c].$element;return d._focusedField.focus()}d._focusedField=d.fields[c].$element}}if(null===d._focusedField){return null}return d._focusedField.focus()},_getErrorMessage:function(d,e){var c=e.name+"Message";if("undefined"!==typeof d.options[c]){return window.ParsleyValidator.formatMessage(d.options[c],e.requirements)}return window.ParsleyValidator.getErrorMessage(e)},_diff:function(d,l,c){var g=[],k=[];for(var f=0;f<d.length;f++){var h=false;for(var e=0;e<l.length;e++){if(d[f].assert.name===l[e].assert.name){h=true;break}}if(h){k.push(d[f])}else{g.push(d[f])}}return{kept:k,added:g,removed:!c?this._diff(l,d,true).added:[]}},setupForm:function(c){c.$element.on("submit.Parsley",false,$.proxy(c.onSubmitValidate,c));if(false===c.options.uiEnabled){return}c.$element.attr("novalidate","")},setupField:function(d){var c={active:false};if(false===d.options.uiEnabled){return}c.active=true;d.$element.attr(d.options.namespace+"id",d.__id__);c.$errorClassHandler=this._manageClassHandler(d);c.errorsWrapperId="parsley-id-"+("undefined"!==typeof d.options.multiple?"multiple-"+d.options.multiple:d.__id__);c.$errorsWrapper=$(d.options.errorsWrapper).attr("id",c.errorsWrapperId);c.lastValidationResult=[];c.validatedOnce=false;c.validationInformationVisible=false;d._ui=c;this._insertErrorWrapper(d);this.actualizeTriggers(d)},_manageClassHandler:function(d){if("string"===typeof d.options.classHandler&&$(d.options.classHandler).length){return $(d.options.classHandler)}var c=d.options.classHandler(d);if("undefined"!==typeof c&&c.length){return c}if("undefined"===typeof d.options.multiple||d.$element.is("select")){return d.$element}return d.$element.parent()},_insertErrorWrapper:function(c){var d;if("string"===typeof c.options.errorsContainer){if($(c.options.errorsContainer+"").length){return $(c.options.errorsContainer).append(c._ui.$errorsWrapper)}else{if(window.console&&window.console.warn){window.console.warn("The errors container `"+c.options.errorsContainer+"` does not exist in DOM")}}}if("function"===typeof c.options.errorsContainer){d=c.options.errorsContainer(c)}if("undefined"!==typeof d&&d.length){return d.append(c._ui.$errorsWrapper)}return"undefined"===typeof c.options.multiple?c.$element.after(c._ui.$errorsWrapper):c.$element.parent().after(c._ui.$errorsWrapper)},actualizeTriggers:function(c){var e=this;if(c.options.multiple){$("["+c.options.namespace+'multiple="'+c.options.multiple+'"]').each(function(){$(this).off(".Parsley")})}else{c.$element.off(".Parsley")}if(false===c.options.trigger){return}var d=c.options.trigger.replace(/^\s+/g,"").replace(/\s+$/g,"");if(""===d){return}if(c.options.multiple){$("["+c.options.namespace+'multiple="'+c.options.multiple+'"]').each(function(){$(this).on(d.split(" ").join(".Parsley ")+".Parsley",false,$.proxy("function"===typeof c.eventValidate?c.eventValidate:e.eventValidate,c))})}else{c.$element.on(d.split(" ").join(".Parsley ")+".Parsley",false,$.proxy("function"===typeof c.eventValidate?c.eventValidate:this.eventValidate,c))}},eventValidate:function(c){if(new RegExp("key").test(c.type)){if(!this._ui.validationInformationVisible&&this.getValue().length<=this.options.validationThreshold){return}}this._ui.validatedOnce=true;this.validate()},manageFailingFieldTrigger:function(c){c._ui.failedOnce=true;if(c.options.multiple){$("["+c.options.namespace+'multiple="'+c.options.multiple+'"]').each(function(){if(!new RegExp("change","i").test($(this).parsley().options.trigger||"")){return $(this).on("change.ParsleyFailedOnce",false,$.proxy(c.validate,c))}})}if(c.$element.is("select")){if(!new RegExp("change","i").test(c.options.trigger||"")){return c.$element.on("change.ParsleyFailedOnce",false,$.proxy(c.validate,c))}}if(!new RegExp("keyup","i").test(c.options.trigger||"")){return c.$element.on("keyup.ParsleyFailedOnce",false,$.proxy(c.validate,c))}},reset:function(c){c.$element.off(".Parsley");c.$element.off(".ParsleyFailedOnce");if("undefined"===typeof c._ui){return}if("ParsleyForm"===c.__class__){return}c._ui.$errorsWrapper.children().each(function(){$(this).remove()});this._resetClass(c);c._ui.validatedOnce=false;c._ui.lastValidationResult=[];c._ui.validationInformationVisible=false},destroy:function(c){this.reset(c);if("ParsleyForm"===c.__class__){return}c._ui.$errorsWrapper.remove();delete c._ui},_successClass:function(c){c._ui.validationInformationVisible=true;c._ui.$errorClassHandler.removeClass(c.options.errorClass).addClass(c.options.successClass)},_errorClass:function(c){c._ui.validationInformationVisible=true;c._ui.$errorClassHandler.removeClass(c.options.successClass).addClass(c.options.errorClass)},_resetClass:function(c){c._ui.$errorClassHandler.removeClass(c.options.successClass).removeClass(c.options.errorClass)}};return b});