define(function(){return function(a){describe("ParsleyAbstract",function(){it("should provide a actualizeOptions() method",function(){$("body").append('<input type="email" data-parsley-pattern="[A-F][0-9]{5}" data-parsley-required id="element" />');var b=new a("#element",{foo:"bar"});expect(b.options).have.key("pattern");expect(b.options).have.key("required");$("#element").removeAttr("data-parsley-pattern");b.actualizeOptions();expect(b.options).not.to.have.key("pattern");expect(b.options).have.key("required")});it("should use subscribe()",function(b){$("body").append('<input type="email" data-parsley-pattern="[A-F][0-9]{5}" data-parsley-required id="element" />');var c=new a("#element");c.subscribe("parsley:field:foo",function(d,e){expect(d.__id__).to.be(c.__id__);expect(e).to.be("baz");b()});$.emit("parsley:field:foo","bar");$.emit("parsley:field:foo",c,"baz")});it("should use unsubscribe()",function(){$("body").append('<input type="email" id="element" />');var b=$("#element").parsley();b.subscribe("foo",function(){return"bar"});expect($.subscribed().foo.length).to.be(1);b.unsubscribe("foo");expect($.subscribed().foo.length).to.be(0)});it("should use reset() on field",function(){$("body").append('<input type="email" data-parsley-pattern="[A-F][0-9]{5}" data-parsley-required id="element" />');var b=new a("#element");b.validate();expect($("#parsley-id-"+b.__id__+" li").length).to.be(1);b.reset();expect($("#parsley-id-"+b.__id__+" li").length).to.be(0)});it("should use reset() on form",function(c){$("body").append('<form id="element"><input id="field1" type="text" required /><div id="field2"></div><textarea id="field2"></textarea></form>');var b=new a($("#element"));b.validate();expect($("#parsley-id-"+$("#field1").psly().__id__+" li").length).to.be(1);b.subscribe("parsley:form:reset",function(){c()});b.reset();expect($("#parsley-id-"+$("#field1").psly().__id__+" li").length).to.be(0)});it("should use destroy() on field",function(b){$("body").append('<input type="email" data-parsley-pattern="[A-F][0-9]{5}" data-parsley-required id="element" />');var c=new a("#element");c.subscribe("parsley:field:destroy",function(){b()});expect($("#element").data("Parsley")).to.have.key("__class__");expect($("#element").data("Parsley").__class__).to.be("ParsleyField");c.destroy();expect($("#element").data("Parsley")).to.be(undefined)});it("should use destroy() on form",function(d){var c=0;$("body").append('<form id="element"><input id="field1" type="text"/><div id="field2"></div><textarea id="field2"></textarea></form>');var b=new a($("#element"));var e=0;b.subscribe("parsley:field:destroy",function(){e++});b.subscribe("parsley:form:destroy",function(){expect(e).to.be(2);$.listen("parsley:form:validate",function(){expect(true).to.be(false)});$("#element").on("submit",function(f){f.preventDefault();expect($("#element").data("Parsley")).to.be(undefined);expect($("#field1").data("Parsley")).to.be(undefined);$.unsubscribeAll("parsley:form:validate");d()});$("#element").submit()});expect($("#element").data("Parsley")).to.have.key("__class__");expect($("#element").data("Parsley").__class__).to.be("ParsleyForm");expect($("#field1").data("Parsley")).to.have.key("__class__");expect($("#field1").data("Parsley").__class__).to.be("ParsleyField");b.destroy()});afterEach(function(){if($("#element").length){$("#element").remove()}if($(".parsley-errors-list").length){$(".parsley-errors-list").remove()}})})}});